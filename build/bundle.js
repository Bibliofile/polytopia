!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(3);var r;!function(e){e[e.none=0]="none",e[e.amphibian=1]="amphibian",e[e.archer=2]="archer",e[e.baby_dragon=3]="baby_dragon",e[e.battleship=4]="battleship",e[e.boat=5]="boat",e[e.catapult=6]="catapult",e[e.crab=7]="crab",e[e.defender=8]="defender",e[e.dragon_egg=9]="dragon_egg",e[e.fire_dragon=10]="fire_dragon",e[e.giant=11]="giant",e[e.knight=12]="knight",e[e.mind_bender=13]="mind_bender",e[e.navalon=14]="navalon",e[e.polytaur=15]="polytaur",e[e.rider=16]="rider",e[e.ship=17]="ship",e[e.swordsman=18]="swordsman",e[e.tridention=19]="tridention",e[e.warrior=20]="warrior"}(r=t.UnitType||(t.UnitType={}));const i={[r.none]:"None",[r.amphibian]:"Amphibian",[r.archer]:"Archer",[r.baby_dragon]:"Baby Dragon",[r.battleship]:"Battleship",[r.boat]:"Boat",[r.catapult]:"Catapult",[r.crab]:"Crab",[r.defender]:"Defender",[r.dragon_egg]:"Dragon Egg",[r.fire_dragon]:"Fire Dragon",[r.giant]:"Giant",[r.knight]:"Knight",[r.mind_bender]:"Mind Bender",[r.navalon]:"Navalon",[r.polytaur]:"Polytaur",[r.rider]:"Rider",[r.ship]:"Ship",[r.swordsman]:"Swordsman",[r.tridention]:"Tridention",[r.warrior]:"Warrior"};t.getUnitName=function(e){return i[e]};const o={[r.none]:[NaN,NaN,NaN],[r.amphibian]:[2,1,10],[r.archer]:[2,1,10],[r.baby_dragon]:[3,3,15],[r.battleship]:[4,3,NaN],[r.boat]:[1,1,NaN],[r.catapult]:[4,0,10],[r.crab]:[4,4,40],[r.defender]:[1,3,15],[r.dragon_egg]:[0,2,10],[r.fire_dragon]:[4,3,20],[r.giant]:[5,4,40],[r.knight]:[3.5,1,15],[r.mind_bender]:[0,1,10],[r.navalon]:[4,4,30],[r.polytaur]:[3,1,15],[r.rider]:[2,1,10],[r.ship]:[2,2,NaN],[r.swordsman]:[3,3,15],[r.tridention]:[3,1,15],[r.warrior]:[2,2,10]};t.rangedUnits=[r.archer,r.fire_dragon,r.mind_bender,r.boat,r.ship,r.battleship],t.waterUnits=[r.navalon,r.amphibian,r.tridention,r.crab,r.fire_dragon,r.boat,r.ship,r.battleship],t.carryUnits=[r.boat,r.ship,r.battleship],t.unitsWithoutVeteran=[r.giant,r.navalon,r.dragon_egg,r.baby_dragon,r.fire_dragon,r.crab];t.Unit=class{constructor(e,t,n){this._veteran=!1,this.type=e,t instanceof a.Player?this.player=t:this.carrying=t,this.health=null==n?this.maxHealth:n}get attack(){return o[this.type][0]}get defense(){return o[this.type][1]}get maxHealth(){return this.carrying?this.carrying.maxHealth:this.veteran?o[this.type][2]+5:o[this.type][2]}get defenseForce(){return this.defense*(this.health/this.maxHealth)}get attackForce(){return this.attack*(this.health/this.maxHealth)}get health(){return this.carrying?this.carrying.health:null==this._health?this._health=this.maxHealth:this._health}set health(e){this.carrying?this.carrying.health=e:this._health=Math.min(e,this.maxHealth)}get veteran(){return this.carrying?this.carrying.veteran:this._veteran}set veteran(e){this.carrying?this.carrying.veteran=e:t.unitsWithoutVeteran.includes(this.type)||(this._veteran=e)}get player(){return this.carrying?this.carrying.player:this._player}set player(e){this.carrying?this.carrying.player=e:this._player=e}get isRanged(){return t.rangedUnits.includes(this.type)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(0);var r;!function(e){e[e.city=1]="city",e[e.walledCity=2]="walledCity",e[e.mountain=4]="mountain",e[e.forest=8]="forest",e[e.field=16]="field",e[e.ocean=32]="ocean",e[e.dock=64]="dock"}(r=t.SquareFlags||(t.SquareFlags={}));class i{getDefenseForce(){if(!this.unit)return 0;let e=1;return this.flags&r.walledCity?[a.UnitType.navalon,a.UnitType.amphibian,a.UnitType.crab,a.UnitType.tridention].includes(this.unit.type)||(e=4):this.flags&(r.ocean|r.dock)&&this.unit.player.hasAquatism?e=1.5:this.flags&r.forest&&this.unit.player.hasAquatism?e=1.5:this.flags&r.mountain&&this.unit.player.hasMeditation?e=1.5:this.flags&r.city&&(e=1.5),this.unit.defenseForce*e}get isLand(){return 0==(this.flags&(r.ocean|r.dock))}constructor(e=r.field,t){this.flags=e,this.unit=t}}t.Square=i;t.Map=class{constructor(e){if(e<0||e>30)throw new Error("size is out of bounds.");this.size=e,this.squares=Array.from({length:e}).map(()=>Array.from({length:e}).map(()=>new i))}getSquare(e,t){if(e<0||e>=this.size)throw new Error("x is out of bounds");if(t<0||t>=this.size)throw new Error("y is out of bounds");return this.squares[e][t]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(1),r=n(3),i=n(0);class o{constructor(e){this.map=new a.Map(e),this.player1=new r.Player,this.player2=new r.Player}move(e,t,n,a){const r=this.map.getSquare(e,t);if(!r.unit)return;const l=this.map.getSquare(n,a);if(!l.unit)return void this.moveUnit(r,l);if(r.unit.player===l.unit.player)return;const s=l.getDefenseForce(),u=r.unit.attackForce+s;if(r.unit.type!==i.UnitType.mind_bender){if(l.unit.health-=Math.round(r.unit.attackForce/u*r.unit.attack*o.ACCELERATOR),l.unit.health<=0)return l.unit=void 0,void this.moveUnit(r,l);Math.abs(e-n)<2&&Math.abs(t-a)<2&&(r.unit.health-=Math.round(s/u*l.unit.defense*o.ACCELERATOR),r.unit.health<=0&&(r.unit=void 0))}else l.unit.player=r.unit.player}moveUnit(e,t){e.unit&&(i.rangedUnits.includes(e.unit.type)||(!e.isLand&&t.isLand?t.unit=e.unit.carrying||e.unit:e.isLand&&!t.isLand?t.unit=i.waterUnits.includes(e.unit.type)?e.unit:new i.Unit(i.UnitType.boat,e.unit):t.unit=e.unit,e.unit=void 0))}}o.ACCELERATOR=4.5,t.Game=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Player=class{constructor(e){this.hasAquatism=!0,this.hasMeditation=!0,this.hasArchery=!0,Object.assign(this,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(5);const a=n(2),r=n(0),i=n(1),o=n(6);window.game=new a.Game(18),window.state={x:0,y:0};const l=document.querySelector("[data-for=tileTitle]"),s=document.querySelector("[data-for=tile]"),u=document.querySelector("[data-for=unitAllowed]"),c=document.querySelector("[data-for=veteran]"),_=document.querySelector("[data-for=carrying]"),d=document.querySelector("[data-for=unitCarry]"),h=document.querySelector("[data-for=health]"),g=document.querySelector("[data-for=player]"),p=document.querySelector("canvas");p.width=p.height=o.CANVAS_SIZE;const y=p.getContext("2d");function f(e){const t=document.body.appendChild(document.createElement("textarea"));t.value=e,t.select(),document.execCommand("copy"),t.remove()}if(document.querySelector("[data-for=copyTiles]").addEventListener("click",()=>{f(window.exportTilesToString())}),document.querySelector("[data-for=copyUnits]").addEventListener("click",()=>{f(window.exportUnitsToString())}),!y)throw new Error("Failed to get canvas context.");document.querySelector("[data-for=clearState]").addEventListener("click",()=>{localStorage.clear(),window.game=new a.Game(game.map.size),w()});for(const e of Object.keys(i.SquareFlags).filter(e=>!isNaN(+e))){const t=s.appendChild(document.createElement("option"));t.value=e,t.textContent=(m=i.SquareFlags[e])[0].toUpperCase()+m.substr(1).replace(/([A-Z])/g," $1")}var m;for(const e of Object.keys(r.UnitType).filter(e=>!isNaN(+e))){const t=u.appendChild(document.createElement("option"));t.value=e,t.textContent=r.getUnitName(+e)}const O=Object.keys(r.UnitType).filter(e=>!isNaN(+e)).filter(e=>!r.waterUnits.includes(+e)&&+e!==r.UnitType.none);for(const e of O){const t=d.appendChild(document.createElement("option"));t.value=e,t.textContent=r.getUnitName(+e)}function L(e,t){e.hasArchery=t.querySelector('[data-for="archery"]').checked,e.hasAquatism=t.querySelector('[data-for="aquatism"]').checked,e.hasMeditation=t.querySelector('[data-for="meditation"]').checked}function w(){const e=game.map.getSquare(state.x,state.y);s.value=e.flags,l.textContent=`Tile (${state.x}, ${state.y})`,e.unit?(u.value=e.unit.type+"",c.checked=e.unit.veteran,g.checked=e.unit.player===game.player1,_.hidden=!r.carryUnits.includes(e.unit.type),_.hidden||(d.value=e.unit.carrying.type+""),h.value=e.unit.health+""):(u.value=r.UnitType.none+"",_.hidden=!0,c.checked=!1,h.value="0"),S(game.player1,document.querySelector("[data-for=player1]")),S(game.player2,document.querySelector("[data-for=player2]")),localStorage.setItem("unit_map",window.exportUnitsToString()),localStorage.setItem("tile_map",window.exportTilesToString()),localStorage.setItem("player1",JSON.stringify(game.player1)),localStorage.setItem("player2",JSON.stringify(game.player2)),o.render(game,y)}function S(e,t){t.querySelector('[data-for="archery"]').checked=e.hasArchery,t.querySelector('[data-for="aquatism"]').checked=e.hasAquatism,t.querySelector('[data-for="meditation"]').checked=e.hasMeditation}function b(e,t){const{width:n,height:a,left:r,top:i}=p.getBoundingClientRect(),o=e-r,l=t-i;return{x:Math.floor(o/n*game.map.size),y:Math.floor(l/a*game.map.size)}}document.addEventListener("input",()=>{const e=+s.value,t=c.checked,n=+u.value,a=+d.value,i=+h.value||void 0;_.hidden=!r.carryUnits.includes(n);const o=game.map.getSquare(state.x,state.y);o.flags=e;const l=n===r.UnitType.none?void 0:r.carryUnits.includes(n)?new r.Unit(n,new r.Unit(a,game.player1,i)):new r.Unit(n,game.player1,i);l?(l.veteran=t,o.isLand||r.waterUnits.includes(l.type)?o.unit=l:o.unit=new r.Unit(r.UnitType.boat,l),o.unit.player=g.checked?game.player1:game.player2):o.unit=void 0,L(game.player1,document.querySelector("[data-for=player1]")),L(game.player2,document.querySelector("[data-for=player2]")),w()}),p.addEventListener("click",({clientX:e,clientY:t})=>{state=b(e,t),w()});let v=state;p.addEventListener("mousedown",e=>{v=b(e.clientX,e.clientY)}),p.addEventListener("mouseup",e=>{const t=b(e.clientX,e.clientY);t.x===v.x&&t.y===v.y||game.move(v.x,v.y,t.x,t.y)}),console.log("Available globals: `state`, `game`, `importTiles`, `exportTilesToString`, `importUnits`, `exportUnitsToString`");window.importTiles(localStorage.getItem("tile_map")||"\nLLDOOOOOOOOODLFFFF\nLCDOOOOOOOODCLFCFF\nLLDOOOOOOOODLMFLLF\nMLMDDOOOOOODFLMLLM\nLWLMCDOODOOOODLLLL\nLLLMLDODWDOOOODWLM\nMLLLLDOODOOOOOODLM\nLWLLWLOOOOOOOOOODL\nLMLLDLDLOOODDDODLL\nMLDDDLLMDOODCLDCLL\nLCDOODCFFOOODDDFLL\nLLLDOOOFLFDOOODLFL\nLMLDOOOFLDOOOOODCL\nLLLDOOODLWDOOOOODD\nLLCDOODFMDOODOOOOO\nLLLOODCMFDODCMDDDM\nLLOOODFLLOODLFLCLM\nLOOOODFFMOOFMLLLLL\n"),window.importUnits(localStorage.getItem("unit_map")||"\n_ _ _ _ 4/12/0/0/15 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _ _ _ _ _\n_ null/12/0/0/15 _ 4/12/0/0/15 4/8/0/0/15 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _ _ _ _ _\nnull/18/0/0/15 null/18/0/0/15 _ _ 4/18/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _ _ _ _ _ _\nnull/18/0/1/15 _ null/18/0/1/15 _ _ _ 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _ _ _ _\n_ null/18/0/1/15 _ _ null/18/0/0/15 _ _ 4/8/0/0/15 _ _ _ _ _ _ _ _ _ _\nnull/6/0/1/10 _ _ _ _ _ _ 4/8/0/0/15 null/13/0/0/10 _ _ _ _ _ _ _ _ _\nnull/12/0/1/15 null/6/0/1/10 null/6/0/1/10 _ _ _ _ 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _ _ _\nnull/6/0/1/10 null/18/0/1/15 null/6/0/1/10 _ null/18/0/1/15 _ _ _ _ 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _ _\nnull/12/0/1/15 _ null/12/0/1/15 _ _ _ _ _ _ 4/8/0/0/15 _ 4/8/0/0/15 _ _ _ _ _ _\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n_ null/12/0/1/15 _ 4/8/0/1/15 _ _ null/18/0/1/15 _ _ _ _ _ _ _ _ _ _ _\n_ _ _ 17/11/0/1/40 4/8/0/1/15 4/8/0/1/15 _ _ _ _ _ 4/8/0/0/15 _ _ _ _ _ _\n_ _ null/13/0/1/10 4/8/0/1/15 _ 4/11/0/1/40 _ _ _ _ _ 4/8/0/0/15 _ _ _ _ _ _\n_ _ _ _ 4/8/0/1/15 _ _ _ _ null/11/0/0/40 _ 4/8/0/0/15 _ _ _ _ _ _\n_ _ null/12/0/1/15 _ _ _ 4/11/0/1/40 _ _ _ _ _ _ _ _ _ _ _\n_ _ _ _ _ _ _ null/18/0/1/15 _ _ _ _ _ _ _ _ _ _\n_ _ _ _ _ _ null/6/0/1/10 _ _ _ 4/8/0/0/15 4/8/0/0/15 _ _ _ _ _ _\n_ _ _ _ _ _ null/6/0/1/10 _ _ _ 4/8/0/0/15 _ _ _ _ _ _ _\n");for(const[e,t]of Object.entries(JSON.parse(localStorage.getItem("player1")||"{}")))game.player1[e]=t;for(const[e,t]of Object.entries(JSON.parse(localStorage.getItem("player2")||"{}")))game.player2[e]=t;w()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(2),r=n(1),i=n(0),o={C:r.SquareFlags.city,W:r.SquareFlags.walledCity,L:r.SquareFlags.field,F:r.SquareFlags.forest,M:r.SquareFlags.mountain,O:r.SquareFlags.ocean,D:r.SquareFlags.dock},l={[r.SquareFlags.city]:"C",[r.SquareFlags.walledCity]:"W",[r.SquareFlags.field]:"L",[r.SquareFlags.forest]:"F",[r.SquareFlags.mountain]:"M",[r.SquareFlags.ocean]:"O",[r.SquareFlags.dock]:"D"};window.importTiles=function(e){const t=e.trim().split("\n"),n=Math.max(t.length,t.reduce((e,t)=>Math.max(e,t.length),0));n>window.game.map.size&&(window.game=new a.Game(n));for(let e=0;e<t.length;e++){const n=t[e];for(let t=0;t<n.length;t++){const a=n[t],r=o[a];null!=r&&(game.map.getSquare(t,e).flags=r)}}},window.exportTilesToString=function(){const e=[];for(let t=0;t<window.game.map.size;t++){let n="";for(let e=0;e<window.game.map.size;e++)n+=l[window.game.map.getSquare(e,t).flags];e.push(n)}return e.join("\n")},window.importUnits=function(e){const t=e.trim().split("\n"),n=Math.max(t.length,t.reduce((e,t)=>Math.max(e,t.split(/\s+/).length),0));n>game.map.size&&(window.game=new a.Game(n));for(let e=0;e<t.length;e++){const n=t[e].split(/\s+/);for(let t=0;t<n.length;t++){if(!/(null|\d+)\/\d+\/[10]\/[10]\/\d+/.test(n[t]))continue;const[,a,r,o,l,s]=n[t].match(/(null|\d+)\/(\d+)\/([10])\/([10])\/(\d+)/),u=i.UnitType[+r];if(!u)continue;const c=i.UnitType[u];let _=new i.Unit(c,+l?game.player1:game.player2,+s);if(_.veteran=!!+o,"null"!==a){const e=i.UnitType[+a];if(!e)continue;const t=i.UnitType[e];_=new i.Unit(t,_)}game.map.getSquare(t,e).unit=_}}},window.exportUnitsToString=function(){const e=[];for(let t=0;t<game.map.size;t++){let n=[];for(let e=0;e<game.map.size;e++){const a=game.map.getSquare(e,t);if(a.unit){const e=a.unit.carrying?a.unit.type:"null",t="null"===e?a.unit.type:a.unit.carrying.type,r=a.unit.player===game.player1;n.push(`${e}/${t}/${+a.unit.veteran}/${+r}/${a.unit.health}`)}else n.push("_")}e.push(n.join(" "))}return e.join("\n")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(0),r=n(1);t.CANVAS_SIZE=1e3;const i={[r.SquareFlags.city]:"#bcbcbc",[r.SquareFlags.dock]:"#35cfff",[r.SquareFlags.field]:"#1cad00",[r.SquareFlags.forest]:"#115e02",[r.SquareFlags.mountain]:"#191919",[r.SquareFlags.ocean]:"#0d0082",[r.SquareFlags.walledCity]:"#545454"};t.render=function(e,n){const{map:r,player1:o}=e,l=t.CANVAS_SIZE/r.size,s=l/4;for(let e=0;e<r.size;e++)for(let t=0;t<r.size;t++)e===window.state.x&&t===window.state.y||u(e,t);function u(e,t){const u=e*l,c=t*l,_=r.getSquare(e,t);n.fillStyle=i[_.flags],n.fillRect(u+2,c+2,l-2,l-2),window.state.x===e&&window.state.y===t?n.strokeStyle="red":n.strokeStyle="white",n.beginPath(),n.lineWidth=2,n.rect(u,c,l,l),n.stroke(),_.unit&&(n.fillStyle=n.strokeStyle=_.unit.player===o?"#ff0000":"#ffee00",n.font=`${s}px sans-serif`,n.fillText(a.getUnitName(_.unit.type).substr(0,3)+` (${_.unit.health}/${_.unit.maxHealth})`,u+2,c+s,l-4))}u(window.state.x,window.state.y)}}]);